---------------------------------
S2
config t

vlan 10
 name GERENCIA
vlan 20
 name VENTAS 

int e2/0
 switchport mode access
 switchport access vlan 10

int e1/0
 switchport mode access
 switchport access vlan 20

int e0/0
 switchport trunk encap dot1q
 switchport mode trunk
 switchport trunk native vlan 99

do wr
---------------------------------
S1
config t

vlan 10
 name GERENCIA
vlan 20
 name VENTAS 

int e0/0
 switchport trunk encap dot1q
 switchport mode trunk
 switchport trunk native vlan 99

int e1/0
 switchport trunk encap dot1q
 switchport mode trunk
 switchport trunk native vlan 99

do wr
-----------------------------------
R1-CE
config t 

int e1/0.10
 encap dot1q 10
 ip add 10.10.10.1 255.255.255.128
int e1/0.20
 encap dot1q 20
 ip add 10.10.20.1 255.255.255.224
int e1/0.99
 encap dot1q 99 native

int e1/0
 no shut

int s4/0
 ip add 7.7.7.1 255.255.255.252
 no shut
int e0/0
 ip add 7.7.7.25 255.255.255.252
 no shut

router bgp 10
 bgp router-id 1.1.1.1
 neighbor 7.7.7.2 remote-as 50
 neighbor 7.7.7.2 activate
 network 10.10.10.0 mask 255.255.255.128
 network 10.10.20.0 mask 255.255.255.224

ip route 0.0.0.0 0.0.0.0 7.7.7.26
do wr
-----------------------------------
R2-PE
config t 

ip cef

ip vrf ESPE
 rd 50:1
 route-target both 50:1

mpls label range 200 299

int lo1
 ip add 2.2.2.2 255.255.255.255

int s4/0
 ip vrf forwarding ESPE
 ip add 7.7.7.2 255.255.255.252

int e0/0
 ip add 7.7.7.13 255.255.255.252 
 no shut
int e1/0
 ip add 7.7.7.5 255.255.255.252 
 no shut

router ospf 2
 router-id 2.2.2.2
 mpls ldp autoconfig
 network 7.7.7.4 0.0.0.3 area 0
 network 7.7.7.12 0.0.0.3 area 0
 network 2.2.2.2 0.0.0.0 area 0

router bgp 50
 neighbor 5.5.5.5 remote-as 50
 neighbor 5.5.5.5 update-source lo1
 address-family vpnv4
 neighbor 5.5.5.5 activate
 neighbor 5.5.5.5 send-community extended
address-family ipv4 vrf ESPE
 neighbor 7.7.7.1 remote-as 10
 neighbor 7.7.7.1 activate
do wr
-----------------------------------
R5-PE
config t 

ip cef

ip vrf ESPE
 rd 50:1
 route-target both 50:1

mpls label range 500 599

int lo1
 ip add 5.5.5.5 255.255.255.255

int s4/0
 ip vrf forwarding ESPE
 ip add 7.7.7.21 255.255.255.252

int e1/0
 ip add 7.7.7.18 255.255.255.252 
 no shut
int e0/0
 ip add 7.7.7.10 255.255.255.252 
 no shut

router ospf 5
 router-id 5.5.5.5
 mpls ldp autoconfig
 network 7.7.7.16 0.0.0.3 area 0
 network 7.7.7.8 0.0.0.3 area 0
 network 5.5.5.5 0.0.0.0 area 0

router bgp 50
 neighbor 2.2.2.2 remote-as 50
 neighbor 2.2.2.2 update-source lo1
 address-family vpnv4
 neighbor 2.2.2.2 activate
 neighbor 2.2.2.2 send-community extended
address-family ipv4 vrf ESPE
 neighbor 7.7.7.22 remote-as 30
 neighbor 7.7.7.22 activate
do wr
-------------------------------------------
R3-P
config t

ip cef

mpls label range 300 399

int lo1
 ip add 3.3.3.3 255.255.255.255

int e0/0
 ip add 7.7.7.9 255.255.255.252
 no shut

int e1/0
 ip add 7.7.7.6 255.255.255.252
 no shut


router ospf 3
 router-id 3.3.3.3
 mpls ldp autoconfig
 network 7.7.7.4 0.0.0.3 area 0
 network 7.7.7.8 0.0.0.3 area 0
 network 3.3.3.3 0.0.0.0 area 0

do wr
-------------------------------------------
R4-P
config t

ip cef

mpls label range 400 499

int lo1
 ip add 4.4.4.4 255.255.255.255

int e0/0
 ip add 7.7.7.14 255.255.255.252
 no shut

int e0/1
 ip add 7.7.7.17 255.255.255.252
 no shut


router ospf 4
 router-id 4.4.4.4
 mpls ldp autoconfig
 network 7.7.7.12 0.0.0.3 area 0
 network 7.7.7.16 0.0.0.3 area 0
 network 4.4.4.4 0.0.0.0 area 0

do wr
-------------------------------------------
R6-CE
config t

int e0/0
 ip add 172.16.100.1 255.255.255.0
 no shut
int s4/0
 ip add 7.7.7.22 255.255.255.252
 no shut

router bgp 30
 bgp router-id 6.6.6.6
 neighbor 7.7.7.21 remote-as 50
 neighbor 7.7.7.21 activate
 network 172.16.100.0 mask 255.255.255.0
do wr
-------------------------------------------
R1-CE

access-list 10 permit 10.10.10.0 0.0.0.127
access-list 10 permit 10.10.20.0 0.0.0.31

ip nat 

ip dhcp excluded-add 10.10.10.1 10.10.10.3
ip dhcp excluded-add 10.10.20.1 10.10.20.3
ip dhcp excluded-add 172.16.100.1 172.16.100.3

ip dhcp pool v10
 network 10.10.10.0 255.255.255.128
 default-router 10.10.10.1
 dns-server 8.8.8.8

ip dhcp pool v20
 network 10.10.20.0 255.255.255.224
 default-router 10.10.20.1
 dns-server 8.8.8.8

ip dhcp pool Sucursal
 network 172.16.100.0 255.255.255.0
 default-router 172.16.100.1
 dns-server 8.8.8.8
